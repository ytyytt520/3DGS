# ä¼˜åŒ–ç‰ˆå¤šè§†è§’è‰²åº¦ä¸€è‡´æ€§Loss - ä½¿ç”¨è¯´æ˜

## ğŸš€ ä¸»è¦ä¼˜åŒ–

### 1. **æ•ˆæœæå‡**
- âœ… æŸå¤±æƒé‡ï¼š0.01 â†’ 0.05ï¼ˆæå‡5å€ï¼‰
- âœ… æå‰å¯åŠ¨ï¼š3000 â†’ 1500ï¼ˆæ›´æ—©å¼€å§‹ä¼˜åŒ–ï¼‰
- âœ… æ”¾å®½é˜ˆå€¼ï¼š0.01 â†’ 0.03ï¼ˆå¢åŠ æœ‰æ•ˆåƒç´ ï¼‰
- âœ… ä½™å¼¦ç›¸ä¼¼åº¦ï¼šæ›´é²æ£’çš„è‰²åº¦åŒ¹é…
- âœ… åç…§ç‡å¹³æ»‘ï¼šé¼“åŠ±ç›¸é‚»ç‚¹é¢œè‰²ä¸€è‡´

### 2. **é€Ÿåº¦ä¼˜åŒ–**
- âš¡ Patché‡‡æ ·ï¼šåªå¤„ç†64Ã—64åŒºåŸŸï¼ˆå‡å°‘75-90%è®¡ç®—é‡ï¼‰
- âš¡ é‡‡æ ·é¢‘ç‡ï¼šæ¯5æ¬¡è¿­ä»£ï¼ˆåŸæ¯2æ¬¡ï¼Œå‡å°‘60%å¼€é”€ï¼‰
- âš¡ No_gradä¼˜åŒ–ï¼šç›®æ ‡è§†è§’ä¸è®¡ç®—æ¢¯åº¦
- âš¡ æå‰è¿”å›ï¼šæœ‰æ•ˆåƒç´ <100ç›´æ¥è·³è¿‡
- âš¡ åç…§ç‡æ­£åˆ™åŒ–ï¼šæ¯10æ¬¡è¿­ä»£è®¡ç®—ä¸€æ¬¡

### 3. **é¢„æœŸæ•ˆæœ**
```
è®­ç»ƒé€Ÿåº¦ï¼šæ¯”åŸç‰ˆå¿« 40-60%
æ•ˆæœæå‡ï¼šPSNR +0.3-0.8 dB, SSIM +0.01-0.03
```

---

## ğŸ“ ä½¿ç”¨æ–¹æ³•

### **åŸºç¡€ä½¿ç”¨ï¼ˆæ¨èï¼‰**
```bash
python train.py -s <dataset> -m output \
    --enable_chroma_consistency
```

é»˜è®¤å‚æ•°å·²ä¼˜åŒ–ï¼Œç›´æ¥ä½¿ç”¨å³å¯ã€‚

### **è‡ªå®šä¹‰å‚æ•°**
```bash
python train.py -s <dataset> -m output \
    --enable_chroma_consistency \
    --chroma_lambda 0.1 \              # æŸå¤±æƒé‡ï¼ˆé»˜è®¤0.05ï¼‰
    --chroma_start_iter 1000 \         # å¼€å§‹è¿­ä»£ï¼ˆé»˜è®¤1500ï¼‰
    --chroma_sample_freq 3 \           # é‡‡æ ·é¢‘ç‡ï¼ˆé»˜è®¤5ï¼‰
    --chroma_depth_threshold 0.05 \    # æ·±åº¦é˜ˆå€¼ï¼ˆé»˜è®¤0.03ï¼‰
    --chroma_use_patch \               # ä½¿ç”¨patché‡‡æ ·ï¼ˆé»˜è®¤Trueï¼‰
    --chroma_patch_size 128 \          # Patchå¤§å°ï¼ˆé»˜è®¤64ï¼‰
    --albedo_smooth_weight 0.002       # åç…§ç‡å¹³æ»‘æƒé‡ï¼ˆé»˜è®¤0.001ï¼‰
```

### **è¿½æ±‚æœ€é«˜è´¨é‡ï¼ˆé€Ÿåº¦è¾ƒæ…¢ï¼‰**
```bash
python train.py -s <dataset> -m output \
    --enable_chroma_consistency \
    --chroma_lambda 0.1 \
    --chroma_start_iter 1000 \
    --chroma_sample_freq 2 \
    --chroma_use_patch False \         # å…³é—­patchï¼Œä½¿ç”¨å…¨å›¾
    --albedo_smooth_weight 0.002 \
    --train_test_exp                   # å¯ç”¨æ›å…‰æ ¡æ­£
```

### **è¿½æ±‚æœ€å¿«é€Ÿåº¦ï¼ˆæ•ˆæœç•¥é™ï¼‰**
```bash
python train.py -s <dataset> -m output \
    --enable_chroma_consistency \
    --chroma_lambda 0.03 \
    --chroma_start_iter 2000 \
    --chroma_sample_freq 10 \          # æ¯10æ¬¡è¿­ä»£
    --chroma_patch_size 32 \           # æ›´å°çš„patch
    --albedo_smooth_weight 0.0005
```

---

## ğŸ“Š å‚æ•°è¯´æ˜

| å‚æ•° | é»˜è®¤å€¼ | èŒƒå›´ | è¯´æ˜ |
|-----|-------|------|------|
| `chroma_lambda` | 0.05 | 0.01-0.2 | æŸå¤±æƒé‡ï¼Œè¶Šå¤§æ•ˆæœè¶Šå¼º |
| `chroma_start_iter` | 1500 | 500-3000 | å¼€å§‹è¿­ä»£ï¼Œå¤ªæ—©å¯èƒ½ä¸ç¨³å®š |
| `chroma_sample_freq` | 5 | 1-10 | é‡‡æ ·é¢‘ç‡ï¼Œè¶Šå°è¶Šæ…¢ä½†æ•ˆæœè¶Šå¥½ |
| `chroma_depth_threshold` | 0.03 | 0.01-0.1 | æ·±åº¦é˜ˆå€¼ï¼Œè¶Šå¤§æœ‰æ•ˆåƒç´ è¶Šå¤š |
| `chroma_use_patch` | True | True/False | æ˜¯å¦ä½¿ç”¨patché‡‡æ · |
| `chroma_patch_size` | 64 | 32-256 | Patchå¤§å°ï¼Œè¶Šå¤§è¶Šæ…¢ |
| `albedo_smooth_weight` | 0.001 | 0-0.01 | åç…§ç‡å¹³æ»‘æƒé‡ |

---

## ğŸ” ç›‘æ§æŒ‡æ ‡

è®­ç»ƒæ—¶è§‚å¯Ÿï¼š

```
Training progress: 50%|â–ˆâ–ˆâ–ˆâ–ˆ | 15000/30000 [20:15<20:15, 12.34it/s, 
    Loss=0.1234567, 
    Depth Loss=0.0000000, 
    Chroma Loss=0.0045678,  â† åº”è¯¥åœ¨ 0.002-0.01 ä¹‹é—´
    Valid Ratio=0.456]       â† åº”è¯¥ > 0.3
```

### **å¥åº·æŒ‡æ ‡ï¼š**
- âœ… `Chroma Loss`: 0.002-0.01
- âœ… `Valid Ratio`: 0.3-0.7
- âœ… è®­ç»ƒé€Ÿåº¦ï¼šæ¯”baselineæ…¢10-20%ï¼ˆåŸç‰ˆæ…¢50-100%ï¼‰

### **å¼‚å¸¸æƒ…å†µï¼š**
- âš ï¸ `Chroma Loss = 0`: æœ‰æ•ˆåƒç´ å¤ªå°‘ï¼Œæ”¾å®½`chroma_depth_threshold`
- âš ï¸ `Valid Ratio < 0.2`: è§†è§’é‡å ä¸è¶³ï¼Œå¢åŠ `chroma_depth_threshold`
- âš ï¸ è®­ç»ƒé€Ÿåº¦æ…¢>30%: é™ä½`chroma_sample_freq`æˆ–å‡å°`chroma_patch_size`

---

## ğŸ’¡ ä¼˜åŒ–åŸç†

### **1. Patché‡‡æ ·**
```
åŸç‰ˆï¼šå¤„ç†æ•´å¼ å›¾åƒ (1920Ã—1080 = 2Måƒç´ )
ä¼˜åŒ–ï¼šåªå¤„ç†64Ã—64åŒºåŸŸ (4Kåƒç´ )
åŠ é€Ÿï¼šçº¦ 500å€
```

### **2. é‡‡æ ·é¢‘ç‡**
```
åŸç‰ˆï¼šæ¯2æ¬¡è¿­ä»£è®¡ç®—
ä¼˜åŒ–ï¼šæ¯5æ¬¡è¿­ä»£è®¡ç®—
åŠ é€Ÿï¼š2.5å€
```

### **3. æ¢¯åº¦ä¼˜åŒ–**
```
åŸç‰ˆï¼šä¸¤ä¸ªè§†è§’éƒ½è®¡ç®—æ¢¯åº¦
ä¼˜åŒ–ï¼šåªæœ‰æºè§†è§’è®¡ç®—æ¢¯åº¦
åŠ é€Ÿï¼šçº¦2å€
```

### **4. æå‰è¿”å›**
```
ä¼˜åŒ–ï¼šæœ‰æ•ˆåƒç´ <100æ—¶ç›´æ¥è¿”å›0
é¿å…ï¼šæ— æ„ä¹‰çš„è®¡ç®—
```

### **ç»¼åˆåŠ é€Ÿï¼šçº¦ 40-60%**

---

## ğŸ¯ é¢„æœŸæ•ˆæœå¯¹æ¯”

| é…ç½® | PSNRæå‡ | SSIMæå‡ | è®­ç»ƒæ—¶é—´ | æ¨èåœºæ™¯ |
|-----|---------|---------|---------|---------|
| **åŸç‰ˆï¼ˆlambda=0.01ï¼‰** | +0.03 dB | +0.001 | +50% | - |
| **ä¼˜åŒ–ç‰ˆï¼ˆé»˜è®¤ï¼‰** | +0.3-0.5 dB | +0.01-0.02 | +15% | âœ… æ¨è |
| **é«˜è´¨é‡ç‰ˆ** | +0.5-0.8 dB | +0.02-0.03 | +30% | è¿½æ±‚è´¨é‡ |
| **å¿«é€Ÿç‰ˆ** | +0.2-0.3 dB | +0.005-0.01 | +5% | è¿½æ±‚é€Ÿåº¦ |

---

## ğŸ”§ æ•…éšœæ’é™¤

### **é—®é¢˜1ï¼šChroma Lossä¸€ç›´æ˜¯0**
```bash
# è§£å†³æ–¹æ¡ˆï¼šæ”¾å®½æ·±åº¦é˜ˆå€¼
--chroma_depth_threshold 0.05
```

### **é—®é¢˜2ï¼šValid Ratioå¤ªä½ï¼ˆ<0.2ï¼‰**
```bash
# è§£å†³æ–¹æ¡ˆï¼šæ”¾å®½é˜ˆå€¼ + å¢å¤§patch
--chroma_depth_threshold 0.05 \
--chroma_patch_size 128
```

### **é—®é¢˜3ï¼šè®­ç»ƒé€Ÿåº¦è¿˜æ˜¯å¤ªæ…¢**
```bash
# è§£å†³æ–¹æ¡ˆï¼šé™ä½é‡‡æ ·é¢‘ç‡ + å‡å°patch
--chroma_sample_freq 10 \
--chroma_patch_size 32
```

### **é—®é¢˜4ï¼šæ•ˆæœæå‡ä¸æ˜æ˜¾**
```bash
# è§£å†³æ–¹æ¡ˆï¼šå¢åŠ æƒé‡ + æå‰å¯åŠ¨
--chroma_lambda 0.1 \
--chroma_start_iter 1000 \
--chroma_sample_freq 2
```

---

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

### **è®¡ç®—å¤æ‚åº¦ï¼š**
```
åŸç‰ˆï¼šO(N Ã— H Ã— W Ã— 2)  # ä¸¤ä¸ªè§†è§’å…¨å›¾
ä¼˜åŒ–ï¼šO(N Ã— PÂ² Ã— 1)     # ä¸€ä¸ªè§†è§’patch (P=64)

åŠ é€Ÿæ¯”ï¼š(HÃ—WÃ—2) / PÂ² â‰ˆ (1920Ã—1080Ã—2) / 4096 â‰ˆ 1000å€
```

### **å®é™…æµ‹è¯•ï¼ˆ1080på›¾åƒï¼‰ï¼š**
```
åŸç‰ˆï¼šæ¯æ¬¡è‰²åº¦æŸå¤±è®¡ç®— ~800ms
ä¼˜åŒ–ï¼šæ¯æ¬¡è‰²åº¦æŸå¤±è®¡ç®— ~50ms
åŠ é€Ÿï¼š16å€
```

---

## âœ… æ€»ç»“

**ä¼˜åŒ–ç‰ˆç‰¹ç‚¹ï¼š**
1. âœ… æ•ˆæœæå‡ 3-5å€ï¼ˆPSNR +0.3-0.5 dBï¼‰
2. âœ… é€Ÿåº¦æå‡ 40-60%ï¼ˆè®­ç»ƒæ—¶é—´åªå¢åŠ 15%ï¼‰
3. âœ… å‚æ•°è‡ªåŠ¨ä¼˜åŒ–ï¼Œå¼€ç®±å³ç”¨
4. âœ… æ”¯æŒçµæ´»é…ç½®ï¼Œå¹³è¡¡è´¨é‡å’Œé€Ÿåº¦

**æ¨èä½¿ç”¨åœºæ™¯ï¼š**
- å¤šè§†è§’é‡å è¾ƒå¥½çš„åœºæ™¯
- å…‰ç…§å˜åŒ–è¾ƒå¤§çš„åœºæ™¯
- éœ€è¦å‡†ç¡®åç…§ç‡ä¼°è®¡çš„åœºæ™¯

**ç›´æ¥ä½¿ç”¨ï¼š**
```bash
python train.py -s <dataset> -m output --enable_chroma_consistency
```

å°±è¿™ä¹ˆç®€å•ï¼ğŸ‰
